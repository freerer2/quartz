## Nginx 설치 및 설정

### Nginx 설치
```sh
sudo apt install nginx -y
```

### SSL 임시 인증 처리
```sh
# gitea가 있다면 아래를 사용 아니면 다른 방법을 통해 키를 발급받는다.
sudo mkdir /etc/nginx/ssl
cd /etc/nginx/ssl
sudo gitea cert --host [domain] #임시 키
```

### Nginx 설정파일 작성
```sh
sudo vi /etc/nginx/sites-available/wikijs
```

```
server {
	listen 80;
	server_name [도메인]; ex) git.lhk.o-r.kr;
	return 301 https://$server_name$request_uri;
}

server {
	listen 443 ssl http2;
	server_name [도메인]; ex) git.lhk.o-r.kr;
	
	ssl_certificate /etc/nginx/ssl/cert.pem;
	ssl_certificate_key /etc/nginx/ssl/key.pem;
	
	location / { 
		proxy_pass http://localhost:3000;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header X-Forwarded-Proto $scheme;
	}	
}
```

### Nginx 설정 적용 및 테스트 및 재시작

```sh
sudo ln -s /etc/nginx/sites-available/wikijs /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

## SSL 인증 및 재인증 자동화 처리

```sh
# certbot
sudo snap install --classic certbot

# 바로가기 링크 설정
sudo ln -s /snap/bin/certbot /usr/bin/certbot

# Nginx 플러그인
sudo apt install python3-certbot-nginx -y

# --nginx 옵셩을 이용해 certbot이 nginx 리로드를 자동으로 수행하게 설정
sudo certbot --nginx -d [도메인] # ex)git.lhk.o-r.kr
```